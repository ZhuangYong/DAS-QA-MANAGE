{"version":3,"sources":["../../src/permission.js"],"names":["_extends2","require","_extends3","_interopRequireDefault","_router","_router2","_store","_store2","_nprogress","_nprogress2","_auth","_elementUi","obj","__esModule","default","hasPermission","roles","permissionRoles","indexOf","some","role","whiteList","beforeEach","to","from","next","start","getToken","path","done","getters","length","dispatch","then","res","data","addRoutes","addRouters","catch","Message","error","meta","query","noGoBack","afterEach"],"mappings":"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","file":"permission.js","sourcesContent":["'use strict';\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _router = require('./router');\n\nvar _router2 = _interopRequireDefault(_router);\n\nvar _store = require('./store');\n\nvar _store2 = _interopRequireDefault(_store);\n\nvar _nprogress = require('nprogress');\n\nvar _nprogress2 = _interopRequireDefault(_nprogress);\n\nrequire('nprogress/nprogress.css');\n\nvar _auth = require('@/utils/auth');\n\nvar _elementUi = require('element-ui');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction hasPermission(roles, permissionRoles) {\n  if (roles.indexOf('admin') >= 0) return true;\n  if (!permissionRoles) return true;\n  return roles.some(function (role) {\n    return permissionRoles.indexOf(role) >= 0;\n  });\n}\n\nvar whiteList = ['/login', '/authredirect'];\n_router2.default.beforeEach(function (to, from, next) {\n  _nprogress2.default.start();\n  if ((0, _auth.getToken)()) {\n    if (to.path === '/login') {\n      next({ path: '/' });\n      _nprogress2.default.done();\n    } else {\n      if (_store2.default.getters.roles.length === 0) {\n        _store2.default.dispatch('GetUserInfo').then(function (res) {\n          var roles = res.data.role;\n          _store2.default.dispatch('GenerateRoutes', { roles: roles }).then(function () {\n            _router2.default.addRoutes(_store2.default.getters.addRouters);\n            next((0, _extends3.default)({}, to));\n          });\n        }).catch(function () {\n          _store2.default.dispatch('FedLogOut').then(function () {\n            _elementUi.Message.error('验证失败,请重新登录');\n            next({ path: '/login' });\n          });\n        });\n      } else {\n        if (hasPermission(_store2.default.getters.roles, to.meta.role)) {\n          next();\n        } else {\n          next({ path: '/401', query: { noGoBack: true } });\n          _nprogress2.default.done();\n        }\n      }\n    }\n  } else {\n    if (whiteList.indexOf(to.path) !== -1) {\n      next();\n    } else {\n      next('/login');\n      _nprogress2.default.done();\n    }\n  }\n});\n\n_router2.default.afterEach(function () {\n  _nprogress2.default.done();\n});\n//# sourceMappingURL=permission.js.map"]}