{"version":3,"sources":["../../../../src/store/modules/user.js"],"names":["user","state","status","code","token","name","avatar","introduction","roles","setting","articlePlatform","mutations","SET_CODE","SET_TOKEN","SET_INTRODUCTION","SET_SETTING","SET_STATUS","SET_NAME","SET_AVATAR","SET_ROLES","actions","LoginByUsername","userInfo","commit","username","trim","resolve","reject","password","then","data","response","catch","error","GetUserInfo","role","LogOut","FedLogOut","ChangeRole"],"mappings":"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","file":"user.js","sourcesContent":["import { loginByUsername, logout, getUserInfo } from '../../api/login';\nimport { getToken, setToken, removeToken } from '../../utils/auth';\n\nconst user = {\n  state: {\n    user: '',\n    status: '',\n    code: '',\n    token: getToken(),\n    name: '',\n    avatar: '',\n    introduction: '',\n    roles: [],\n    setting: {\n      articlePlatform: []\n    }\n  },\n\n  mutations: {\n    SET_CODE: (state, code) => {\n      state.code = code;\n    },\n    SET_TOKEN: (state, token) => {\n      state.token = token;\n    },\n    SET_INTRODUCTION: (state, introduction) => {\n      state.introduction = introduction;\n    },\n    SET_SETTING: (state, setting) => {\n      state.setting = setting;\n    },\n    SET_STATUS: (state, status) => {\n      state.status = status;\n    },\n    SET_NAME: (state, name) => {\n      state.name = name;\n    },\n    SET_AVATAR: (state, avatar) => {\n      state.avatar = avatar;\n    },\n    SET_ROLES: (state, roles) => {\n      state.roles = roles;\n    }\n  },\n\n  actions: {\n    // 用户名登录\n    LoginByUsername({ commit }, userInfo) {\n      const username = userInfo.username.trim();\n      return new Promise((resolve, reject) => {\n        loginByUsername(username, userInfo.password).then(response => {\n          const data = response.data;\n          setToken(response.data.token);\n          commit('SET_TOKEN', data.token);\n          resolve();\n        }).catch(error => {\n          reject(error);\n        });\n      });\n    },\n\n    // 获取用户信息\n    GetUserInfo({ commit, state }) {\n      return new Promise((resolve, reject) => {\n        getUserInfo(state.token).then(response => {\n          if (!response.data) { // 由于mockjs 不支持自定义状态码只能这样hack\n            reject('error');\n          }\n          const data = response.data;\n          commit('SET_ROLES', data.role);\n          commit('SET_NAME', data.name);\n          commit('SET_AVATAR', data.avatar);\n          commit('SET_INTRODUCTION', data.introduction);\n          resolve(response);\n        }).catch(error => {\n          reject(error);\n        });\n      });\n    },\n\n    // 第三方验证登录\n    // LoginByThirdparty({ commit, state }, code) {\n    //   return new Promise((resolve, reject) => {\n    //     commit('SET_CODE', code)\n    //     loginByThirdparty(state.status, state.email, state.code).then(response => {\n    //       commit('SET_TOKEN', response.data.token)\n    //       setToken(response.data.token)\n    //       resolve()\n    //     }).catch(error => {\n    //       reject(error)\n    //     })\n    //   })\n    // },\n\n    // 登出\n    LogOut({ commit, state }) {\n      return new Promise((resolve, reject) => {\n        logout(state.token).then(() => {\n          commit('SET_TOKEN', '');\n          commit('SET_ROLES', []);\n          removeToken();\n          resolve();\n        }).catch(error => {\n          reject(error);\n        });\n      });\n    },\n\n    // 前端 登出\n    FedLogOut({ commit }) {\n      return new Promise(resolve => {\n        commit('SET_TOKEN', '');\n        removeToken();\n        resolve();\n      });\n    },\n\n    // 动态修改权限\n    ChangeRole({ commit }, role) {\n      return new Promise(resolve => {\n        commit('SET_TOKEN', role);\n        setToken(role);\n        getUserInfo(role).then(response => {\n          const data = response.data;\n          commit('SET_ROLES', data.role);\n          commit('SET_NAME', data.name);\n          commit('SET_AVATAR', data.avatar);\n          commit('SET_INTRODUCTION', data.introduction);\n          resolve();\n        });\n      });\n    }\n  }\n};\n\nexport default user;\n"]}