{"version":3,"sources":["../../../../src/store/modules/user.js"],"names":["user","state","status","code","token","name","avatar","introduction","roles","setting","articlePlatform","mutations","SET_CODE","SET_TOKEN","SET_INTRODUCTION","SET_SETTING","SET_STATUS","SET_NAME","SET_AVATAR","SET_ROLES","actions","LoginByUsername","userInfo","commit","username","trim","resolve","reject","password","then","response","catch","error","GetUserInfo","userName","LogOut","FedLogOut","ChangeRole","role","data"],"mappings":"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","file":"user.js","sourcesContent":["import {loginByUsername, logout, getUserInfo} from '../../api/login';\nimport {getToken, setToken, removeToken} from '../../utils/auth';\n\nconst user = {\n    state: {\n        user: '',\n        status: '',\n        code: '',\n        token: getToken(),\n        name: '',\n        avatar: '',\n        introduction: '',\n        roles: [],\n        setting: {\n            articlePlatform: []\n        }\n    },\n\n    mutations: {\n        SET_CODE: (state, code) => {\n            state.code = code;\n        },\n        SET_TOKEN: (state, token) => {\n            state.token = token;\n        },\n        SET_INTRODUCTION: (state, introduction) => {\n            state.introduction = introduction;\n        },\n        SET_SETTING: (state, setting) => {\n            state.setting = setting;\n        },\n        SET_STATUS: (state, status) => {\n            state.status = status;\n        },\n        SET_NAME: (state, name) => {\n            state.name = name;\n        },\n        SET_AVATAR: (state, avatar) => {\n            state.avatar = avatar;\n        },\n        SET_ROLES: (state, roles) => {\n            state.roles = roles;\n        }\n    },\n\n    actions: {\n        // 用户名登录\n        LoginByUsername({commit}, userInfo) {\n            const username = userInfo.username.trim();\n            return new Promise((resolve, reject) => {\n                loginByUsername(username, userInfo.password).then(response => {\n                    setToken(response.token);\n                    commit('SET_TOKEN', response.token);\n                    resolve();\n                }).catch(error => {\n                    reject(error);\n                });\n            });\n        },\n\n        // 获取用户信息\n        GetUserInfo({commit, state}) {\n            return new Promise((resolve, reject) => {\n                getUserInfo(state.token).then(response => {\n                    if (!response) { // 由于mockjs 不支持自定义状态码只能这样hack\n                        reject('error');\n                    }\n                    const {roles, userName, avatar, introduction} = response;\n                    commit('SET_ROLES', roles);\n                    commit('SET_NAME', userName);\n                    commit('SET_AVATAR', avatar);\n                    commit('SET_INTRODUCTION', introduction);\n                    resolve(response);\n                }).catch(error => {\n                    reject(error);\n                });\n            });\n        },\n\n        // 第三方验证登录\n        // LoginByThirdparty({ commit, state }, code) {\n        //   return new Promise((resolve, reject) => {\n        //     commit('SET_CODE', code)\n        //     loginByThirdparty(state.status, state.email, state.code).then(response => {\n        //       commit('SET_TOKEN', response.data.token)\n        //       setToken(response.data.token)\n        //       resolve()\n        //     }).catch(error => {\n        //       reject(error)\n        //     })\n        //   })\n        // },\n\n        // 登出\n        LogOut({commit, state}) {\n            return new Promise((resolve, reject) => {\n                logout(state.token).then(() => {\n                    commit('SET_TOKEN', '');\n                    commit('SET_ROLES', []);\n                    removeToken();\n                    resolve();\n                }).catch(error => {\n                    reject(error);\n                });\n            });\n        },\n\n        // 前端 登出\n        FedLogOut({commit}) {\n            return new Promise(resolve => {\n                commit('SET_TOKEN', '');\n                removeToken();\n                resolve();\n            });\n        },\n\n        // 动态修改权限\n        ChangeRole({commit}, role) {\n            return new Promise(resolve => {\n                commit('SET_TOKEN', role);\n                setToken(role);\n                getUserInfo(role).then(response => {\n                    const data = response.data;\n                    commit('SET_ROLES', data.role);\n                    commit('SET_NAME', data.name);\n                    commit('SET_AVATAR', data.avatar);\n                    commit('SET_INTRODUCTION', data.introduction);\n                    resolve();\n                });\n            });\n        }\n    }\n};\n\nexport default user;\n"]}